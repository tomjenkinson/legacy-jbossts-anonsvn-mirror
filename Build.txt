NOTE: PATCHED EMMA JAR
This build uses a patch of the EMMA Jar, the source code for the patch is available from:
https://svn.jboss.org/repos/labs/labs/jbosstm/workspace/emma
The latest version of the patched emma is available from /ext


------------------------------------------
To build Narayana you should call:
./build.[sh|bat]Â <maven_goals>

To use this wrapper to build an individual module (say arjuna) you would type:
	[./]build.[sh|bat] clean install -pl :arjuna
If you are using a different maven installation to the one provided in tools/maven you need to make sure you have the following options:
	-Dorson.jar.location=/full/path/to/checkout/location/ext/orson-0.5.0.jar -Demma.jar.location=/full/path/to/checkout/location/ext/emma.jar
If you want to be able to cd into a folder to call our shipped maven or a version of maven not shipped with our project (on linux):
	1. Create a file called $HOME/bin/txmvn (assuming $HOME/bin is in the path)
	2. Add the following contents to this file:
	#!/bin/bash
	M2_HOME=~/projects/narayana/trunk/tools/maven/
	PATH=$M2_HOME/bin:$PATH
	EXT_JARS="-Demma.jar.location=\${user.home}/projects/narayana/trunk/ext/emma.jar -Dorson.jar.location=\${user.home}/projects/narayana/trunk/ext/orson-0.5.0.jar"
	mvn $EXT_JARS $@
	3. Ensure that $HOME/bin/txmvn is executable
	4. type something like "txmvn clean install"
NOTE: This does not set the memory options etc that build.[sh|bat] does so you will need to update this script to reflect our changes in build.[sh|bat]
------------------------------------------

Now The Gory Details.

Each module contains a set of maven build scripts, which chiefly just inherits and selectively overrides the parent
 pom.xml  Understanding this approach requires some knowledge of maven's inheritance.

Top level maven builds always start from scratch. Individual module builds on the other hand are incremental,
such that you may rebuild a single module by traversing into its directory and running 'mvn', but only if you
have first built any pre-req modules e.g. via a parent build.

In addition to driving the build of individual modules, the build files in the bundles directories (ArjunaCore,
ArjunaJTA, ArjunaJTS) contain steps to assemble the release directory structure, including docs, scripts,
config files and other ancillaries. These call each other in some cases, as JTS is largely a superset of
JTA and JTA in turn a superset of Core.

3rd party dependency management is done via maven. Note that versions of most 3rd party components are resolved via the JBossAS component-matrix
pom.xml, even when building standalone releases. The version of JBossAS to use is determined by the top level pom.xml
You may need to set up maven to use the jboss.org repositories: http://community.jboss.org/wiki/MavenGettingStarted-Users

The build currently requires Java 6 and maven 3.0.3. Maven is provided in the tools/maven section, though later versions of these tools may work. Download locations are:
http://www.oracle.com/technetwork/java/javase/downloads/index.html
http://maven.apache.org/


A handful of unit tests build and run as part of the normal build. Most test coverage is in the form of integration
tests which reside in the qa/ directory. These are built but not run automatically. See qa/README.txt for usage.


------------------------------------------------------------------
To build and deploy into AS (note, this applies to AS6 - not AS7):
export JAVA_HOME=/usr/local/jdk1.6.0_17
export PATH=$PATH:/usr/local/apache-maven-2.1.0/bin

if [ -d jbossas ]; then
  rm -r jbossas
fi

if [ -f jbossas.tgz ]; then
  rm jbossas.tgz
fi

# don't use fs link, use http
wget http://albany/job/jbossas-trunk/lastSuccessfulBuild/artifact/jbossas.tgz

mkdir jbossas
cd jbossas
tar -xzf ../jbossas.tgz
cd build/target/jboss*
export JBOSS_HOME=`pwd`
cd $WORKSPACE

cd trunk
/usr/local/apache-ant-1.7.1/bin/ant jbossall

# install TS trunk to AS
cd $WORKSPACE
cp trunk/install/lib/jbossjts*.jar jbossas/build/target/jboss*/common/lib
cp trunk/install/lib/jbossjts*.jar jbossas/build/target/jboss*/client
cp trunk/XTS/xts-install/sar/jbossxts.sar jbossas/build/target/jboss-6.0.0-SNAPSHOT/docs/examples/transactions

cd $WORKSPACE/jbossas/testsuite
./build.sh clean
./build.sh
./build.sh -Dtest=jca -Dserver=default test-with-server
./build.sh -Dtest=tm -Dserver=default test-with-server

# TODO: jts mode rpt of above

# xts tests:

# deploy xts into the server
(cd $JBOSS_HOME/docs/examples/transactions; /usr/local/apache-ant-1.7.1/bin/ant -Dtarget.server.dir=../../../server/default xts)
# localjunit unit tests
cp $WORKSPACE/trunk/XTS/xts-install/tests/*.ear $JBOSS_HOME/server/default/deploy
# interop11.war and sc007.war
cp $WORKSPACE/trunk/XTS/xts-install/interop-tests/*.war $JBOSS_HOME/server/default/deploy

export MYTESTIP_1=localhost
cd $JBOSS_HOME/bin
./run.sh -c default -b ${MYTESTIP_1} &> ../../localjunitserver.log &
sleep 60
cd $WORKSPACE/trunk/XTS/localjunit
/usr/local/apache-ant-1.7.1/bin/ant -f run-tests.xml tests-11
/usr/local/apache-ant-1.7.1/bin/ant -f run-interop-tests.xml
cd $JBOSS_HOME/bin
./shutdown.sh -s jnp://${MYTESTIP_1}:1099 --shutdown
sleep 60





